<!DOCTYPE html>
<html
  lang="vi"
  xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{layout_admin}"
>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Đăng tin tức mới</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      href="https://cdn.quilljs.com/1.3.6/quill.snow.css"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", "Segoe UI", sans-serif;
        background-color: #f8fafc;
      }
      .ql-editor {
        min-height: 200px;
        font-size: 16px;
      }
      .file-drop-area {
        border: 2px dashed #d1d5db;
        border-radius: 0.5rem;
        transition: all 0.3s ease;
      }
      .file-drop-area:hover {
        border-color: #3b82f6;
        background-color: #f8fafc;
      }
      .file-drop-area.dragover {
        border-color: #3b82f6;
        background-color: #eff6ff;
      }
      .preview-image {
        max-height: 200px;
        object-fit: cover;
        border-radius: 0.375rem;
      }
      .tag-input:focus {
        outline: none;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      }
    </style>
  </head>
  <main layout:fragment="content" class="bg-gray-50">
    <div class="container mx-auto px-4 py-8">
      <!-- Header Section -->
      <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-800 mb-2">Đăng tin tức mới</h1>
        <p class="text-gray-600">
          Tạo và quản lý tin tức, thông báo của công ty
        </p>
      </div>

      <!-- Main Form -->
      <div class="bg-white rounded-lg shadow p-6 mb-6">
        <form id="newsForm">
          <!-- Basic Information -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >Tiêu đề tin tức *</label
              >
              <input
                type="text"
                required
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200"
                placeholder="Nhập tiêu đề tin tức"
              />
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >Danh mục *</label
              >
              <select
                required
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200"
              >
                <option value="">Chọn danh mục</option>
                <option value="news">Tin tức công ty</option>
                <option value="announcement">Thông báo nội bộ</option>
                <option value="event">Sự kiện</option>
                <option value="policy">Chính sách mới</option>
                <option value="achievement">Thành tựu</option>
              </select>
            </div>
          </div>

          <!-- Image Upload -->
          <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700 mb-2"
              >Hình ảnh đại diện</label
            >
            <div
              class="file-drop-area relative p-6 text-center cursor-pointer"
              id="imageDropArea"
            >
              <input
                type="file"
                id="imageUpload"
                accept="image/*"
                class="absolute inset-0 w-full h-full opacity-0 cursor-pointer"
              />
              <div class="flex flex-col items-center justify-center">
                <i
                  class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-3"
                ></i>
                <p class="text-gray-600 mb-1">
                  Kéo thả hình ảnh vào đây hoặc click để chọn
                </p>
                <p class="text-sm text-gray-500">JPG, PNG, GIF - Tối đa 5MB</p>
              </div>
            </div>
            <div id="imagePreview" class="mt-3 hidden">
              <img
                src=""
                class="preview-image w-full"
                alt="Xem trước hình ảnh đại diện tin tức"
              />
              <button
                type="button"
                onclick="removeImage()"
                class="mt-2 text-red-600 hover:text-red-800 text-sm"
              >
                <i class="fas fa-times mr-1"></i>Xóa ảnh
              </button>
            </div>
          </div>

          <!-- Content Editor -->
          <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700 mb-2"
              >Nội dung tin tức *</label
            >
            <div id="editor" style="min-height: 300px"></div>
          </div>

          <!-- Tags and Meta Information -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >Thẻ tags</label
              >
              <input
                type="text"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg tag-input focus:border-blue-500 focus:ring-2 focus:ring-blue-200"
                placeholder="Nhập tags (cách nhau bằng dấu phẩy)"
              />
              <p class="text-sm text-gray-500 mt-1">
                Ví dụ: tin tức, sự kiện, công ty, nhân sự
              </p>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >Trạng thái</label
              >
              <select
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200"
              >
                <option value="draft">Bản nháp</option>
                <option value="published">Công khai</option>
                <option value="private">Nội bộ</option>
              </select>
            </div>
          </div>

          <!-- File Attachments -->
          <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700 mb-2"
              >File đính kèm</label
            >
            <div
              class="file-drop-area relative p-4 text-center cursor-pointer"
              id="fileDropArea"
            >
              <input
                type="file"
                id="fileUpload"
                multiple
                class="absolute inset-0 w-full h-full opacity-0 cursor-pointer"
              />
              <div class="flex items-center justify-center">
                <i class="fas fa-paperclip text-xl text-gray-400 mr-2"></i>
                <p class="text-gray-600">
                  Kéo thả file vào đây hoặc click để chọn
                </p>
              </div>
            </div>
            <div id="fileList" class="mt-3 space-y-2 hidden">
              <!-- File list will be generated here -->
            </div>
          </div>

          <!-- Publish Options -->
          <div class="mb-6 p-4 bg-gray-50 rounded-lg">
            <h3 class="text-lg font-semibold text-gray-800 mb-3">
              Tùy chọn đăng tin
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >Ngày đăng</label
                >
                <input
                  type="datetime-local"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200"
                />
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >Ngày hết hạn</label
                >
                <input
                  type="datetime-local"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200"
                />
              </div>
            </div>
            <div class="mt-4">
              <label class="flex items-center">
                <input
                  type="checkbox"
                  class="rounded border-gray-300 text-blue-600 focus:ring-blue-500"
                />
                <span class="ml-2 text-sm text-gray-700"
                  >Gửi thông báo email cho nhân viên</span
                >
              </label>
            </div>
          </div>

          <!-- Action Buttons -->
          <div
            class="flex flex-col sm:flex-row gap-3 pt-6 border-t border-gray-200"
          >
            <button
              type="submit"
              class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium flex items-center justify-center"
            >
              <i class="fas fa-paper-plane mr-2"></i>
              Đăng tin ngay
            </button>
            <button
              type="button"
              class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-medium flex items-center justify-center"
            >
              <i class="fas fa-save mr-2"></i>
              Lưu nháp
            </button>
            <button
              type="button"
              class="border border-gray-300 hover:bg-gray-50 text-gray-700 px-6 py-3 rounded-lg font-medium flex items-center justify-center"
            >
              <i class="fas fa-eye mr-2"></i>
              Xem trước
            </button>
            <button
              type="reset"
              class="border border-gray-300 hover:bg-gray-50 text-gray-700 px-6 py-3 rounded-lg font-medium flex items-center justify-center"
            >
              <i class="fas fa-times mr-2"></i>
              Hủy bỏ
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Quill JS -->
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <script>
      // Initialize Quill editor
      const quill = new Quill("#editor", {
        theme: "snow",
        modules: {
          toolbar: [
            [{ header: [1, 2, 3, 4, 5, 6, false] }],
            ["bold", "italic", "underline", "strike"],
            [{ color: [] }, { background: [] }],
            [{ align: [] }],
            ["link", "image", "video"],
            ["clean"],
          ],
        },
        placeholder: "Nhập nội dung tin tức tại đây...",
      });

      // Image upload handling
      const imageDropArea = document.getElementById("imageDropArea");
      const imageUpload = document.getElementById("imageUpload");
      const imagePreview = document.getElementById("imagePreview");
      const previewImg = imagePreview.querySelector("img");

      imageDropArea.addEventListener("dragover", function (e) {
        e.preventDefault();
        this.classList.add("dragover");
      });

      imageDropArea.addEventListener("dragleave", function () {
        this.classList.remove("dragover");
      });

      imageDropArea.addEventListener("drop", function (e) {
        e.preventDefault();
        this.classList.remove("dragover");
        const file = e.dataTransfer.files[0];
        handleImageFile(file);
      });

      imageUpload.addEventListener("change", function (e) {
        const file = e.target.files[0];
        handleImageFile(file);
      });

      function handleImageFile(file) {
        if (file && file.type.startsWith("image/")) {
          const reader = new FileReader();
          reader.onload = function (e) {
            previewImg.src = e.target.result;
            imagePreview.classList.remove("hidden");
            imageDropArea.style.display = "none";
          };
          reader.readAsDataURL(file);
        }
      }

      function removeImage() {
        previewImg.src = "";
        imagePreview.classList.add("hidden");
        imageDropArea.style.display = "block";
        imageUpload.value = "";
      }

      // File attachments handling
      const fileDropArea = document.getElementById("fileDropArea");
      const fileUpload = document.getElementById("fileUpload");
      const fileList = document.getElementById("fileList");

      fileDropArea.addEventListener("dragover", function (e) {
        e.preventDefault();
        this.classList.add("dragover");
      });

      fileDropArea.addEventListener("dragleave", function () {
        this.classList.remove("dragover");
      });

      fileDropArea.addEventListener("drop", function (e) {
        e.preventDefault();
        this.classList.remove("dragover");
        const files = e.dataTransfer.files;
        handleFiles(files);
      });

      fileUpload.addEventListener("change", function (e) {
        const files = e.target.files;
        handleFiles(files);
      });

      function handleFiles(files) {
        if (files.length > 0) {
          fileList.classList.remove("hidden");
          fileList.innerHTML = "";

          Array.from(files).forEach((file) => {
            const fileItem = document.createElement("div");
            fileItem.className =
              "flex items-center justify-between p-3 bg-gray-50 rounded-lg";
            fileItem.innerHTML = `
                        <div class="flex items-center">
                            <i class="fas fa-file text-gray-400 mr-3"></i>
                            <div>
                                <p class="text-sm font-medium text-gray-800">${
                                  file.name
                                }</p>
                                <p class="text-xs text-gray-500">${formatFileSize(
                                  file.size
                                )}</p>
                            </div>
                        </div>
                        <button type="button" onclick="removeFile(this)" class="text-red-600 hover:text-red-800">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
            fileList.appendChild(fileItem);
          });
        }
      }

      function removeFile(button) {
        const fileItem = button.closest("div");
        fileItem.remove();

        if (fileList.children.length === 0) {
          fileList.classList.add("hidden");
        }
      }

      function formatFileSize(bytes) {
        if (bytes === 0) return "0 Bytes";
        const k = 1024;
        const sizes = ["Bytes", "KB", "MB", "GB"];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + " " + sizes[i];
      }

      // Form submission
      document
        .getElementById("newsForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();
          // Handle form submission here
          console.log("Form submitted");
          alert("Tin tức đã được đăng thành công!");
        });
    </script>
  </main>
</html>
