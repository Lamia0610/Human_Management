<!DOCTYPE html>
<html lang="vi"
  xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{layout.html}">
<head>
  <meta charset="UTF-8" />
  <title>Ti·∫øp nh·∫≠n ph·∫£n h·ªìi</title>
  <style>
    #feedbackPage {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f5f9ff;
      color: #333;
    }
    #feedbackPage header {
      background: #1e88e5;
      color: #fff;
      padding: 15px;
      text-align: center;
    }
    #feedbackPage .content {
      max-width: 800px;
      margin: 20px auto;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
    #feedbackPage h2 {
      color: #1e88e5;
    }
    #feedbackPage label {
      display: block;
      margin: 8px 0 5px;
    }
    #feedbackPage textarea,
    #feedbackPage input,
    #feedbackPage select {
      width: 100%;
      padding: 10px;
      margin-bottom: 15px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    #feedbackPage button {
      background: #1e88e5;
      color: #fff;
      border: none;
      padding: 10px 16px;
      border-radius: 5px;
      cursor: pointer;
    }
    #feedbackPage button:hover {
      background: #1565c0;
    }
    #feedbackPage .feedback-list {
      margin-top: 25px;
    }
    #feedbackPage .feedback-item {
      border: 1px solid #ccc;
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 12px;
      background: #f9f9f9;
    }
    #feedbackPage .status {
      font-weight: bold;
      color: #1565c0;
    }
    #feedbackPage .topic {
      font-style: italic;
      color: #555;
    }
  </style>
</head>

<main layout:fragment="content" id="feedbackPage">
  <header>
    <h1>üì© Ti·∫øp nh·∫≠n ph·∫£n h·ªìi nh√¢n vi√™n</h1>
  </header>

  <div class="content">
    <h2>G·ª≠i ph·∫£n h·ªìi</h2>
    <form id="feedbackForm">
      <label for="name">H·ªç t√™n</label>
      <input type="text" id="name" name="name"
             th:value="${nhanVien.hoTen}" readonly />

      <label for="topic">V·∫•n ƒë·ªÅ h·ªó tr·ª£</label>
      <select id="topic" required>
        <option value="">-- Ch·ªçn v·∫•n ƒë·ªÅ --</option>
        <option value="L∆∞∆°ng">üí∞ L∆∞∆°ng</option>
        <option value="Ngh·ªâ ph√©p">üìÖ Ngh·ªâ ph√©p</option>
        <option value="Thi·∫øt b·ªã">üíª Thi·∫øt b·ªã</option>
        <option value="Kh√°c">üìù Kh√°c</option>
      </select>

      <label for="message">N·ªôi dung ph·∫£n h·ªìi</label>
      <textarea id="message" rows="4" placeholder="Nh·∫≠p ph·∫£n h·ªìi chi ti·∫øt..." required></textarea>

      <button type="submit">üöÄ G·ª≠i ph·∫£n h·ªìi</button>
    </form>

    <div class="feedback-list">
      <h2>üìã Danh s√°ch ph·∫£n h·ªìi</h2>
      <div id="feedbackContainer"></div>
    </div>
  </div>

  <script>
    const form = document.getElementById("feedbackForm");
    const feedbackContainer = document.getElementById("feedbackContainer");
    const nameInput = document.getElementById("name");

    // T·∫£i ph·∫£n h·ªìi t·ª´ localStorage khi trang ƒë∆∞·ª£c t·∫£i
    document.addEventListener("DOMContentLoaded", () => {
        const storedFeedbacks = JSON.parse(localStorage.getItem('feedbacks')) || [];
        storedFeedbacks.forEach(feedback => addFeedbackToDOM(feedback));
    });

    // X·ª≠ l√Ω s·ª± ki·ªán g·ª≠i form
    form.addEventListener("submit", function (e) {
        e.preventDefault();
        const name = nameInput.value.trim();
        const topic = document.getElementById("topic").value.trim();
        const message = document.getElementById("message").value.trim();

        if (name && topic && message) {
            const newFeedback = {
                name: name,
                topic: topic,
                message: message,
                status: "ƒêang ch·ªù duy·ªát",
                timestamp: new Date().toISOString()
            };

            // Th√™m v√†o DOM
            addFeedbackToDOM(newFeedback);

            // L∆∞u v√†o localStorage
            const storedFeedbacks = JSON.parse(localStorage.getItem('feedbacks')) || [];
            storedFeedbacks.unshift(newFeedback); // Th√™m v√†o ƒë·∫ßu m·∫£ng
            localStorage.setItem('feedbacks', JSON.stringify(storedFeedbacks));

            form.reset();
            nameInput.value = name; // gi·ªØ l·∫°i t√™n nh√¢n vi√™n
        }
    });

    // H√†m th√™m m·ªôt ph·∫£n h·ªìi v√†o DOM
    function addFeedbackToDOM(feedback) {
        const div = document.createElement("div");
        div.classList.add("feedback-item");

        div.innerHTML = `
            <p><strong>${feedback.name}</strong> <span class="topic">(${feedback.topic})</span></p>
            <p>${feedback.message}</p>
            <p>Tr·∫°ng th√°i: <span class="status">${feedback.status}</span></p>
            <label>ƒê·ªïi tr·∫°ng th√°i:
                <select>
                    <option value="ƒêang ch·ªù duy·ªát" ${feedback.status === "ƒêang ch·ªù duy·ªát" ? "selected" : ""}>ƒêang ch·ªù duy·ªát</option>
                    <option value="ƒê√£ duy·ªát" ${feedback.status === "ƒê√£ duy·ªát" ? "selected" : ""}>ƒê√£ duy·ªát</option>
                    <option value="ƒê√£ x·ª≠ l√Ω" ${feedback.status === "ƒê√£ x·ª≠ l√Ω" ? "selected" : ""}>ƒê√£ x·ª≠ l√Ω</option>
                </select>
            </label>
        `;
        feedbackContainer.prepend(div);
        
        // G√°n s·ª± ki·ªán cho select m·ªõi t·∫°o
        const selectEl = div.querySelector('select');
        selectEl.addEventListener('change', (e) => updateStatus(e.target, feedback.timestamp));
    }
    
    // C·∫≠p nh·∫≠t tr·∫°ng th√°i
    function updateStatus(selectEl, timestamp) {
        const newStatus = selectEl.value;
        const statusSpan = selectEl.closest(".feedback-item").querySelector(".status");
        statusSpan.textContent = newStatus;

        // C·∫≠p nh·∫≠t trong localStorage
        const storedFeedbacks = JSON.parse(localStorage.getItem('feedbacks')) || [];
        const feedbackToUpdate = storedFeedbacks.find(fb => fb.timestamp === timestamp);
        if (feedbackToUpdate) {
            feedbackToUpdate.status = newStatus;
            localStorage.setItem('feedbacks', JSON.stringify(storedFeedbacks));
        }
    }
</script>
</main>
</html>
